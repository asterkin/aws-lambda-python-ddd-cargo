#!/usr/bin/env python3

import sys
from importlib import import_module

template = """
AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: %s service SAM template. Automatically generated by nahash/samgen
Resources:
%s
"""

funcTemplate = """  $NAME:
        Type: 'AWS::Serverless::Function'
        Properties:
            Handler: $NAME.lambda_handler
            Runtime: python3.6
            CodeUri: s3://$BUCKET/$NAME.zip
            Description: $DOC
            MemorySize: 128
            Timeout: 3
"""
def resource(bucket):
    return lambda name: funcTemplate.replace('$BUCKET', bucket).replace('$NAME', name).replace('$DOC', import_module(name).__doc__)

def resources(service, functions):
    return ''.join(map(resource(service.lower()), functions))

def generateTemplate(service, functions):
    print(template % (service, resources(service, functions)))

generateTemplate(sys.argv[1], sys.argv[2:])


